<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="monetag" content="3aebd9ebbba1b779613f4488fb3b0da1" />
  <title>Create Account - Money Master</title>
  <link rel="stylesheet" href="register.css" />
  <link rel="icon" href="assets/money_master_favicon.png" />
  <script src="https://www.google.com/recaptcha/enterprise.js?render=6LfWNRorAAAAANtRO74W-GG8rmOwqly3ZNOZ5Py1"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDo6BwWCRTexL_-lUwgy41FYB3zpJKRiWU",
      authDomain: "money-master-89c02.firebaseapp.com",
      databaseURL: "https://money-master-89c02-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "money-master-89c02",
      storageBucket: "money-master-89c02.appspot.com",
      messagingSenderId: "226410161274",
      appId: "1:226410161274:web:62793ff8d39e0d642707c3",
      measurementId: "G-62K0SFSZK4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    
    // Make available globally
    window.db = db;
    window.auth = auth;
  </script>
</head>
<body>

  <!-- Back Navigation -->
  <img src="assets/icon_navigation.png" class="nav-icon" onclick="goBack()" alt="Back" />

  <div class="register-container">
    <img src="assets/icon_create.png" class="app-icon" alt="Create Icon" />
    <h2 class="register-title">CREATE ACCOUNT</h2>

    <!-- Toggle -->
    <div class="toggle-type">
      <label><input type="radio" name="type" value="email" checked onchange="toggleType()"> Email</label>
      <label><input type="radio" name="type" value="mobile" onchange="toggleType()"> Mobile</label>
    </div>

    <!-- Registration Form -->
    <form class="register-form" id="registerForm" onsubmit="handleCaptcha(event)">
      <input type="text" id="name" placeholder="Your Name" required />
      <input type="text" id="email" placeholder="Email or Mobile" required />
      <input type="password" id="password" placeholder="Password" required />
      <input type="password" id="confirm" placeholder="Confirm Password" required />
      <input type="text" id="referralCode" placeholder="Referral Code (optional)" />
      <div id="otpBox"></div>
      <button type="submit">CREATE ACCOUNT</button>
    </form>

    <p class="disclaimer">Use a valid mobile or email. Required for withdrawals & recovery.</p>
    <p class="small-link">By signing up, you agree to our <a href="terms.html">Terms & Privacy Policy</a></p>
  </div>

  <script>
    function goBack() {
      const clickSound = new Audio("assets/sound.mp3");
      clickSound.play();
      window.location.href = "index.html";
    }

    function toggleType() {
      const type = document.querySelector('input[name="type"]:checked').value;
      const input = document.getElementById("email");
      input.placeholder = type === "email" ? "Email" : "Mobile Number (10 digits)";
      
      // Clear OTP box when switching to email
      if (type === "email") {
        document.getElementById("otpBox").innerHTML = "";
      }
    }

    function handleCaptcha(e) {
      e.preventDefault();

      grecaptcha.ready(function () {
        grecaptcha.execute('6LfWNRorAAAAANtRO74W-GG8rmOwqly3ZNOZ5Py1', { action: 'submit' })
          .then(function (token) {
            registerUser(e, token); // Pass token to registerUser
          });
      });
    }
  </script>

  <!-- Load register.js last so it gets token properly -->
  <script type="module" src="register.js"></script>
</body>
</html>
